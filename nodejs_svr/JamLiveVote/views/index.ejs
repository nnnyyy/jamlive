<!DOCTYPE html>
<html>
  <head>
      <title>JAM LIVE ( 잼라이브 ) 정답 공유기</title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" charset="utf-8" />
      <meta name="description" content="JAM LIVE ( 잼라이브 ) 퀴즈 문제의 정답을 서로 공유하여 당첨률을 높이기 위해 제작 된 사이트"/>
      <meta property="og:type" content="website">
      <meta property="og:title" content="JAM LIVE ( 잼라이브 ) 정답 공유기">
      <meta property="og:description" content="JAM LIVE ( 잼라이브 ) 퀴즈 문제의 정답을 서로 공유하여 당첨률을 높이기 위해 제작 된 사이트">
      <meta property="og:image" content="http://4seasonpension.com:4647/images/hotcom_banner.jpg">
      <meta property="og:url" content="http://4seasonpension.com:4647">
      <link rel="stylesheet" href="//cdn.jsdelivr.net/chartist.js/latest/chartist.min.css">
      <script src="//cdn.jsdelivr.net/chartist.js/latest/chartist.min.js"></script>
      <script src="http://code.jquery.com/jquery-3.2.1.js"></script>
      <script src="/basic.js"></script>
      <link rel='stylesheet' href='/stylesheets/style.css' />
  </head>
  <body>
  <!-- HTML Design -->
  <div id ='mainframe'>
      <div class="content">
          <maintitle>라이브 퀴즈쇼 정답 투표기</maintitle><br/>
          <subtitle>힘을 합쳐서 정답을 공유 해 보아요!(참여인원 :<usercnt id="usercnt">0</usercnt>명)</subtitle><br/>
          <div id="quiztypedesc">잼라이브, 라이브팝, 페이큐 이용자에게 유용합니다</div>
          <info>[투표방법] PC : 키보드 1,2,3 번 or 버튼, 모바일 : 버튼</info><br/>
          <input type="button" class="btn_vote" data="0" value="1번"/>
          <input type="button" class="btn_vote" data="1" value="2번"/>
          <input type="button" class="btn_vote" data="2" value="3번"/>
          <div class="ct-chart" style="margin:auto;width: 40%; height: 300px; "></div>
          <div id="banner_area">
              <img class="ads_banner" src="/images/hotcom_banner.jpg"/>
              <!-- 구글 플레이 스토어 링크 -->
              <a target='_blank' href="https://play.google.com/store/apps/details?id=com.sononpos.communityviwerex&hl=ko"><img class="ads_banner" src="/images/playstore.png"/></a>
              <!-- 애플 스토어 링크 -->
              <a target='_blank' href="https://itunes.apple.com/kr/app/%ED%95%AB-%EC%BB%A4%EB%AE%A4%EB%8B%88%ED%8B%B0/id1237566765?l=en&mt=8"><img class="ads_banner" src="/images/appstore.png"/></a>
          </div>
          <div class="ct-barchart" style="height: 300px; "></div>
      </div>
      <div id="chat">
          <header class="top-bar">
              <chattitle style="margin-left: 20px;line-height: 40px;">채팅</chattitle>
              <!-- likely some spans and stuff -->
          </header>
          <div class="chatscrollarea">
              <ul id="chatwndul">
              </ul>
          </div>
          <div class="chatinputarea">
              <div id="chatnicknamearea"><input class="chatnickname" type="text"></div>
              <div id="chatinputboxarea"><input class="chatinputbox" type="text"/></div>
          </div>
      </div>
      <ins class="daum_ddn_area" style="display:none;margin-top:30px"
           data-ad-unit    = "DAN-1hbghejif3l2e"
           data-ad-media   = "5MC"
           data-ad-pubuser = "4jp"
           data-ad-type    = "D"
           data-ad-width   = "250"
           data-ad-height  = "250"></ins>
      <script type="text/javascript" src="//t1.daumcdn.net/adfit/static/ad.min.js"></script>
  </div>
  <!-- Script -->
  <script>
      var color = ['#DE5B49','#324D5C', '#F0CA4D' ];

      function showMainBarChart(labelSeries, dataSeries) {
          var data = {
              labels: labelSeries,
              series: dataSeries
          };

          var options = {
              seriesBarDistance: 10,
              axisX: {
                  offset: 60
              },
              axisY: {
                  offset: 80
              }
          };

          var chart = new Chartist.Bar('.ct-chart', data, options);
          chart.on('draw', function(context) {
              if( context.type == 'bar') {
                  var c = color[context.index % 3];
                  context.element.attr({

                      // Now we set the style attribute on our bar to override the default color of the bar. By using a HSL colour we can easily set the hue of the colour dynamically while keeping the same saturation and lightness. From the context we can also get the current value of the bar. We use that value to calculate a hue between 0 and 100 degree. This will make our bars appear green when close to the maximum and red when close to zero.
                      style: 'stroke: ' + c
                  });
              }
          })
      }

      function showBarChart(labelSeries, dataSeries) {
          var data = {
              labels: labelSeries,
              series: dataSeries
          };

          var options = {
              seriesBarDistance: 10,
              axisX: {
                  offset: 60
              },
              axisY: {
                  offset: 80
              }
          };

          var chart = new Chartist.Bar('.ct-barchart', data, options);
          chart.on('draw', function(context) {
              if( context.type == 'bar') {
                  var c = color[context.seriesIndex % 3];
                  context.element.attr({

                      // Now we set the style attribute on our bar to override the default color of the bar. By using a HSL colour we can easily set the hue of the colour dynamically while keeping the same saturation and lightness. From the context we can also get the current value of the bar. We use that value to calculate a hue between 0 and 100 degree. This will make our bars appear green when close to the maximum and red when close to zero.
                      style: 'stroke: ' + c
                  });
              }
          })
      }

      function addChat(msg, bStrip) {
          var bAutoMoveToBottom = false;
          var chatwndheight = $('.chatscrollarea').height();
          if( $('#chatwndul').find('li').length > 200 ) {
              $('#chatwndul').find('li').eq(0).remove();
          }

          if( $('.chatscrollarea').get(0).scrollTop == ($('.chatscrollarea').get(0).scrollHeight - chatwndheight) ) {
              bAutoMoveToBottom = true;
          }


          $('#chatwndul').append('<li><div class="message"><p>' + (bStrip ? strip(msg) : msg) + '</p></div></li>')
          if( bAutoMoveToBottom ) {
              $('.chatscrollarea').scrollTop($('.chatscrollarea').get(0).scrollHeight);
          }
      }

      function vote(socket, data) {
          data.nickname = getNickName();
          socket.emit('vote', data);
      }

      function getNickName() {
          var nick = strip($('.chatnickname').val());
          nick = nick.substr(0,14);
          return nick;
      }

      function SearchWeb(msg) {
          var width = $(window).width();
          var height = $(window).height();
          var widthSearch =width/2;
          var posX = width - widthSearch;
          window.open("https://www.google.co.kr/search?q=" + msg + ' site:namu.wiki', "", "width=" + widthSearch + " , height="+height+", left=" + posX +", top=0;scrollbars=1");
      }

      var tClick = 0;
      var bTrigger = false;

      $(document).ready(function(){
          console.log(navigator.userAgent);
          if( isMobile() ) {
              // is mobile..
              $('.ct-chart').css('width','90%');
              $('.btn_vote').css('width','30%');
              $('#chat').css('visibility','hidden');
              $('.content').css('width', '100%');
          }

          var socket = io();
          socket.on('disconnect' , function() {
              alert('동시 접속 불가');
              self.close();
          });

          socket.on('testdata', function(data) {
              var users = data.users;
              $('#usercnt').text(users);
              var p = JSON.parse(data.cnt)._data;
              var ret = [0,0,0];
              var barLabelRet = [];
              var barDataSeriesRet = [[],[],[]];
              for( var key in p ) {
                  var t = new Date(1970, 0, 1); // Epoch
                  t.setSeconds(key);
                  t.setHours(t.getHours() + 9 + 9);
                  ret[0] += p[key][1][0];
                  ret[1] += p[key][1][1];
                  ret[2] += p[key][1][2];

                  barLabelRet.push(t.toISOString());
                  barDataSeriesRet[0].push({value:p[key][1][0]});
                  barDataSeriesRet[1].push({value:p[key][1][1]});
                  barDataSeriesRet[2].push({value:p[key][1][2]});
              }

              showBarChart(barLabelRet, barDataSeriesRet);
              showMainBarChart(['1번','2번','3번'],[ret]);
              //$('#votecnt').text(JSON.stringify(ret));

          })

          socket.on('chat', function(data) {
              if( data.isvote != -1 ) {
                  addChat( data.nickname + ' : <b style="color: '+ color[data.isvote] + '">' + data.msg + '</b>', false);
              }
              else {
                  addChat(data.nickname + ' : ' + data.msg, true);
              }
          })

          $('.btn_vote').each(function(idx) {
              $(this).click(function() {
                  var idx = $(this).attr('data');
                  vote(socket, {idx:idx});
              });
          })

          $(document).keypress(function(event) {
              if( $('.chatinputbox').is(':focus') ) return;
              if( $('.chatnickname').is(':focus') ) return;
              if( event.charCode >= 49 && event.charCode <= 51) {
                  var curTime = new Date();
                  if( curTime - tClick < 100 ) {
                      return;
                  }
                  tClick = curTime;

                  var idx = event.charCode - 49;

                  var nick = getNickName();
                  var clicked = (idx+1);
                  vote(socket, {idx: idx });
              }
              else {
                  $('.chatinputbox').val('');
                  $('.chatinputbox').focus();
                  bTrigger = true;
              }
          })

          $('.chatinputbox').keypress(function(e) {
              var code = (e.keyCode ? e.keyCode : e.which);
              if( code == 13 ) {
                  var nick = getNickName();
                  var msg = $(this).val();
                  if( msg.length > 40 ) {
                      alert('메시지는 짧게');
                      $('.chatinputbox').val('');
                      return;
                  }

                  if( msg.length <= 0 ) {
                      return;
                  }

                  if( msg[0] == '/' ) {
                      $('.chatinputbox').val('');
                      $('.chatinputbox').blur();
                      SearchWeb(msg.substr(1));
                      return;
                  }

                  var isvote = -1;
                  if( msg.search(/11+/g) != -1 ) {
                      vote(socket, {idx:0});
                      isvote = 0;
                  }
                  else if( msg.search(/22+/g) != -1 ) {
                      vote(socket, {idx:1});
                      isvote = 1;
                  }
                  else if( msg.search(/33+/g) != -1 ) {
                      vote(socket, {idx:2});
                      isvote = 2;
                  }

                  nick = nick.substr(0,14);
                  socket.emit('chat', {nickname: nick, msg: msg, isvote: isvote });
                  $(this).val('');
              }
          })

          $('.chatinputbox').keyup(function(e) {
              var code = (e.keyCode ? e.keyCode : e.which);
              if( bTrigger ) {
                  bTrigger = false;
                  $(this).val('');
                  return;
              }
              if( code == 27 ) {
                  $(this).blur();
              }
          })

          var rd = Math.floor(Math.random() * 50000);
          $('.chatnickname').val('guest' + rd);

          addChat("<b>채팅창에서 포커스를 떼고(esc 버튼) 1~3번 키를 눌러서 투표를 할수도 있고, </br>'1111', '22','333' 등을 입력해서 투표할 수도 있습니다</br><search style='color: darkblue;'>슬래시(/)를 누른 후에 채팅을 입력하시면 구글 검색결과가 새 창으로 열립니다</search></b>", false);
          addChat("<a href='/quiz' target='_blank'><b style='color:red;font-size: larger'>이곳</b></a>을 클릭하시면 기출문제를 풀 수 있는 페이지로 이동합니다.", false);
      });
  </script>
  <script src="/socket.io/socket.io.js"></script>
  </body>
</html>
