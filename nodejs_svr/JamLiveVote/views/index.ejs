<!DOCTYPE html>
<html>
  <head>
      <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" charset="utf-8" />
      <link rel="stylesheet" href="//cdn.jsdelivr.net/chartist.js/latest/chartist.min.css">
      <script src="//cdn.jsdelivr.net/chartist.js/latest/chartist.min.js"></script>
      <script src="http://code.jquery.com/jquery-3.2.1.js"></script>
      <link rel='stylesheet' href='/stylesheets/style.css' />
  </head>
  <body>
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- JamLive페이지용 광고 -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-3598320494828213"
       data-ad-slot="4326018437"
       data-ad-format="auto"></ins>
  <script>
      (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
  <!-- HTML Design -->
  JamLive Answer Vote System<br/>
  click : <votecount id="votecnt"></votecount>
  <input type="button" class="btn_vote" data="0" value="1번"/>
  <input type="button" class="btn_vote" data="1" value="2번"/>
  <input type="button" class="btn_vote" data="2" value="3번"/>
  <div class="ct-chart" style="height: 300px; background-color:#ffffff"></div>
  <div class="ct-barchart" style="height: 300px; background-color:#ffffff"></div>
  <!-- Script -->
  <script>
      function showPieChart(dataSeries) {
          var data = {
              labels: ['1번', '2번', '3번'],
              series: dataSeries
          };

          var options = {
              labelInterpolationFnc: function(value) {
                  return value[0]
              }
          };

          var responsiveOptions = [
              ['screen and (min-width: 640px)', {
                  chartPadding: 30,
                  labelOffset: 100,
                  labelDirection: 'explode',
                  labelInterpolationFnc: function(value) {
                      return value;
                  }
              }],
              ['screen and (min-width: 1024px)', {
                  labelOffset: 80,
                  chartPadding: 20
              }]
          ];
          new Chartist.Pie('.ct-chart', data, options, responsiveOptions);
      }

      function showBarChart(labelSeries, dataSeries) {
          var data = {
              labels: labelSeries,
              series: dataSeries
          };

          var options = {
              seriesBarDistance: 10,
              axisX: {
                  offset: 60
              },
              axisY: {
                  offset: 80
              }
          };

          new Chartist.Bar('.ct-barchart', data, options);
      }

      function showChart(data) {
          new Chartist.Line('.ct-chart', {
              series: [
                  data
              ]
          }, {
              seriesBarDistance: 1,
              low: 0,
              high: 100,
              fullWidth: true,
              chartPadding: {
                  right: 40
              }
          });
      }

      $(document).ready(function(){
          var socket = io();
          socket.on('testdata', function(data) {
              var p = JSON.parse(data.cnt)._data;
              var ret = [1,1,1];
              var barLabelRet = [];
              var barDataSeriesRet = [[],[],[]];
              for( var key in p ) {
                  var t = new Date(1970, 0, 1); // Epoch
                  t.setSeconds(key);
                  t.setHours(t.getHours() + 9 + 9);
                  ret[0] += p[key][1][0];
                  ret[1] += p[key][1][1];
                  ret[2] += p[key][1][2];

                  barLabelRet.push(t.toISOString());
                  barDataSeriesRet[0].push(p[key][1][0]);
                  barDataSeriesRet[1].push(p[key][1][1]);
                  barDataSeriesRet[2].push(p[key][1][2]);
              }

              showBarChart(barLabelRet, barDataSeriesRet);
              showPieChart(ret);
              //$('#votecnt').text(JSON.stringify(ret));
          })

          $('.btn_vote').each(function(idx) {
              $(this).click(function() {
                  socket.emit('vote', {idx:$(this).attr('data')})
              });
          })
      });
  </script>
  <script src="/socket.io/socket.io.js"></script>
  </body>
</html>
