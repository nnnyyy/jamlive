<!DOCTYPE html>
<html>
<head>
    <title>라이브 퀴즈 정답 공유기 v0.3</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" charset="utf-8" />
    <meta name="description" content="라이브 퀴즈쇼(잼라이브, 더퀴즈라이브, 라이브팟, 페이큐)의 정답을 서로 공유하여 당첨률을 높이기 위해 제작 된 사이트"/>
    <meta property="og:type" content="website">
    <meta property="og:title" content="라이브 퀴즈쇼 정답 공유기">
    <meta property="og:description" content="JAM LIVE ( 잼라이브 ) 퀴즈 문제의 정답을 서로 공유하여 당첨률을 높이기 위해 제작 된 사이트">
    <meta property="og:image" content="http://jamlive.net/images/main_icon.png">
    <meta property="og:url" content="http://jamlive.net">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/chartist.js/latest/chartist.min.css">
    <script src="//cdn.jsdelivr.net/chartist.js/latest/chartist.min.js"></script>
    <script src="http://code.jquery.com/jquery-3.2.1.js"></script>
    <script src="/basic.js"></script>
    <script src="/myChart.js"></script>
    <link rel='stylesheet' href='/stylesheets/style_new.css' />
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
        (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-3598320494828213",
            enable_page_level_ads: true
        });
    </script>
</head>
<body>
<!-- HTML Design -->
<script src="/socket.io/socket.io.js"></script>
<div class="main_frame">
    <div class="header">
        <div class="logo">
            라이브 퀴즈 정답 공유기 <guide class="guide_btn">사용법을 모르시면 클릭</guide>
        </div>
        <div class="logo_bot">
            팩트 : 사이트 보고 틀린 문제는 어차피 틀렸을 문제다. 틀리면 자신을 탓하라. 그리고 <a href="http://quiz.jamlive.net" target="_blank">여기를 클릭</a>해서 기출문제를 풀고 연습하라.
        </div>
    </div>
    <div class="content">
        <!--
            왼쪽에 사용 방법 설명창 ( 열고 닫을 수 있는 )
            왼쪽에 지식인 검색
            가운데에 표
            오른쪽에 채팅창
        -->
        <div class="content_left">
            <div class="search_root">
                <div style="text-align: center;height:15px;">
                    <input type="checkbox" id="cb_s0" name="chk_info" value="0" checked>백과사전
                    <input type="checkbox" id="cb_s1" name="chk_info" value="1" checked>지식인
                    <input type="checkbox" id="cb_s2" name="chk_info" value="2" checked>블로그
                    <input type="checkbox" id="cb_s3" name="chk_info" value="3" checked>뉴스
                </div>
                <div class="search_article">
                    <div class="search_top">
                        검색 결과가 표시 됩니다.
                    </div>
                    <!--
                        검색 결과물 출력
                    -->
                    <div class="search_desc">검색방법 : 채팅창에서 /(슬래시) 누른 후 검색어 입력... 그리고 엔터!</div>
                    <div style="text-align: center;">
                        <ins class="daum_ddn_area" style="display:none;margin-top:30px"
                             data-ad-unit    = "DAN-1hbghejif3l2e"
                             data-ad-media   = "5MC"
                             data-ad-pubuser = "4jp"
                             data-ad-type    = "D"
                             data-ad-width   = "250"
                             data-ad-height  = "250"></ins>
                        <script type="text/javascript" src="//t1.daumcdn.net/adfit/static/ad.min.js"></script>
                    </div>
                    <div style="text-align: center;width: 100%;margin-bottom: 10px;">
                        <b>심심할 땐 구글 플레이스토어에서 '핫커뮤니티'를 검색하세요!</b>
                        <img src="/images/hotcom_banner.jpg" style="height: 40px;"/><br>
                        <a target="_blank" href="https://play.google.com/store/apps/details?id=com.sononpos.communityviwerex&hl=ko"><img src="/images/playstore.png" style="height: 40px;"/></a>
                        <a target="_blank" href="https://itunes.apple.com/kr/app/%ED%95%AB-%EC%BB%A4%EB%AE%A4%EB%8B%88%ED%8B%B0/id1237566765?l=en&mt=8"><img src="/images/appstore.png" style="height: 40px;"/></a>
                    </div>
                </div>
            </div>
        </div>
        <div class="content_mid">
            <div class="mid_sub_top">
                실시간 투표 참여 인원
            </div>
            <div class="mid_article">
                <vote_user_cnt>0</vote_user_cnt>명
            </div>
            <div class="mid_desc">
                <desc>키보드 1,2,3 번을 누르거나 아래의 버튼을 클릭하면 투표가 됩니다.</desc>
            </div>
            <div class="mid_btn_area">
                <input type="button" class="btn_vote" data="0" value="1번"/>
                <input type="button" class="btn_vote" data="1" value="2번"/>
                <input type="button" class="btn_vote" data="2" value="3번"/>
            </div>
            <div class="ct-chart">

            </div>
            <div style="text-align: center;">
                <ins class="kakao_ad_area" style="display:none;width:100%"
                     data-ad-unit    = "DAN-t87e91n4i053"
                     data-ad-width   = "320"
                     data-ad-height  = "50"></ins>
                <script type="text/javascript" src="//t1.daumcdn.net/adfit/static/ad.min.js" async></script>
            </div>
            <div class="mid_caution">
                투표는 확실히 아는 것에만 부탁드립니다!
            </div>
            <div class="mid_sub_top">
                투표에서 제외된 ip 리스트 수
            </div>
            <div class="mid_article">
                <vote_except>0</vote_except>개
            </div>
            <div style="text-align: center;">
                <input type="checkbox" class="cb_auto_search" value="반자동 검색"/>반자동 검색 (정확도는 떨어지나 타자 치기 귀찮을 때 )
            </div>
        </div>
        <div class="content_right">
            <div class="chat_top">
                실시간 채팅 <sub>( 부정 투표자 아이디를 클릭하면 신고 가능 )</sub>
            </div>
            <div style="height: 20px; margin-left: 12px;">
                <input type="checkbox" id="cb_auto_scroll" value="auto scroll"/>강제 자동 스크롤 ( 스크롤이 안되는분들 임시 조치 )
            </div>
            <div class="chat_root">
                <div class="chat_msg">
                    <ul class="chat_ul">
                    </ul>
                </div>
                <div class="chat_input">
                    <input class="ip_name" type="text"><input class="ip_msg" type="text">
                </div>
            </div>
        </div>
    </div>
    <div class="footer">
        <div class="bottom_ads">
            <div style="float: left;">
                <script type="text/javascript" src="//rsc.adpies.com/js/adpie-min.js?mediaId=5b18b0ef8aec491cc678ab2d&slotId=5b18b3108aec491cc678ab31&adType=banner&width=468&height=60&dtype=2"></script>
            </div>
        </div>
    </div>
    <footer>
        <input type="button" class="btn_vote enjoy-css" data="0" value="1번"/>
        <input type="button" class="btn_vote enjoy-css" data="1" value="2번"/>
        <input type="button" class="btn_vote enjoy-css" data="2" value="3번"/>
    </footer>
    <div class="admin_msg">안녕하세요.</div>
    <div class="quiz_wnd">
        <div>[방장 랜덤 기출 문제] <time>0</time></div>
        <div class="q_title">문제</div>
        <div style="height: 10px;"></div>
        <div class="q_q">보기1</div>
        <div class="q_q">보기2</div>
        <div class="q_q">보기3</div>

    </div>
    <div class="youtube_video">
        <iframe width="854" height="480" src="https://www.youtube.com/embed/cUDFcUr8TAs" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
        <div class="youtube_close">닫기</div>
    </div>
</div>
<script>
    var tClick = 0;
    var bTrigger = false;
    var htmlBackup = '';
    var timerID = 0;
    var myid = -1;
    var autoSearchWordMap = new Map();
    var tLast = 0;
    var tAutoSearchFreeze = 0;

    $(document).ready(function(){


        var socket = io();
        registerSocketEvent(socket);
        registerKeyEvent(socket);
        registerClickEvent(socket);

        console.log('event register finish');

        setNickName();
        htmlBackup = $('.search_article').html();

        if( isMobile() ) {
            $('.content_left').css('display','none');
            $('.content_right').css('display','none');
            $('.content_mid').css('width','100%');
            $('.footer').css('display', 'none');
            $('.mid_btn_area').css('display', 'none');
            $('.header').css('text-align','center');
            $('.header').css('height','100px');
            $('.logo').css('width','100%');
            $('.logo').css('margin-left','0px');
            $('.logo').css('font-size','20px');
            $('.logo_bot').css('display', 'none');
            $('guide').css('display','none');
        }
        else {
            $('footer').css('display','none');
        }

        $('.quiz_wnd').css('display', 'none');
    });

    function registerClickEvent( socket ) {
        $('.youtube_close').click(function(e){
            $('.youtube_video').css('display', 'none');
        });

        $('.youtube_video').css('display', 'none');

        $('.guide_btn').click(function(e){
            $('.youtube_video').css('display', 'inline-block');
        });

        $(document).on('click', '.chat_name', function (e) {
            var name = $(this).text();
            if( confirm('신고가 모이면 이 아이피는 당분간 투표에 참여할 수 없습니다."' + name + '"를 신고하시겠습니까? ') ) {
                socket.emit('ban', {hash: $(this).attr('hash')});
            }
            e.preventDefault();
        });
    }

    function registerSocketEvent( socket ) {
        socket.on('myid', function(data) {
            myid = data.socket;
        })

        socket.on('vote_data', function(data) {
            var users = data.users;
            $('vote_user_cnt').text(users);
            $('vote_except').text(data.bans);

            showBarChart('.ct-chart',['1번','2번','3번'],[data.cnt], {
                seriesBarDistance: 10,
                height: 260,
                axisX: {
                    offset: 20
                },
                axisY: {
                    offset: 20
                }
            });
        });

        socket.on('chat', function(data) {
            if( data.mode == "vote" ) {
                if( data.admin ) {
                    data.nickname = '<div class="admin_font">사이트관리자</div>';
                }
                addChat( data.isBaned, data.hash, data.nickname, '<b style="color: '+ color[data.vote] + '">' + data.msg + '</b>', false);
            }
            else if( data.mode == "search") {
                if( data.admin ) {
                    data.nickname = '<div class="admin_font">사이트관리자</div>';
                }
                addChat( data.isBaned, data.hash, data.nickname, '<b style="color: #1b3440">' + data.msg + '</b>', false);
                if( data.id != myid && isAutoSearchChecked() ) {
                    var tCur = new Date();
                    if( tCur - tAutoSearchFreeze <= 5000) {
                        return;
                    }

                    if( tCur - tLast > 1500 ) {
                        autoSearchWordMap.clear();
                    }

                    tLast = tCur;

                    var arr = data.msg.substr(5).split(' ');
                    for( var i = 0 ; i < arr.length ; ++i ) {
                        autoSearchWordMap.put(arr[i], 1);
                    }

                    if( autoSearchWordMap.size() >= 3){
                        var s = '';
                        var aKeys = autoSearchWordMap.keys();
                        for( var i = 0 ; i < aKeys.length ; ++i  ) {
                            s += aKeys[i];
                            s += ' ';
                        }
                        autoSearchWordMap.clear();
                        tAutoSearchFreeze = tCur;
                        searchWebRoot(this, s, false);
                    }
                }
            }
            else {

                if( data.admin ) {
                    showAdminMsg(data.msg);
                    addChat( data.isBaned, data.hash, '<div class="admin_font">사이트관리자</div>', data.msg, false);
                }
                else {
                    addChat( data.isBaned, data.hash, data.nickname, data.msg, true);
                }

            }

            var rd = Math.floor(Math.random() * 30);
            if( rd == 15 ) {
                addBannerAds();
            }
        })

        socket.on('serv_msg', onServMsg);
        socket.on('quiz', onQuiz);
    }

    function onServMsg(data) {
        alert(data.msg);
    }

    var tStartQuiz = 0;
    var idInterval = -1;
    var idTimeout = -1;
    function onQuiz(data) {
        $('.q_q').each(function(idx){
            $(this).css('background-color','transparent');
        })
        $('.quiz_wnd').css('display', 'inline-block');
        $('.q_title').text(data.quizdata.question);
        $('.q_q').each(function(idx) {
            $(this).text((idx+1) + '. ' + data.quizdata.answer[idx]);
        })

        tStartQuiz = new Date();

        clearInterval(idInterval);
        idInterval = setInterval(function() {
            var remain = Math.floor((11000 - (Date.now() - tStartQuiz)) / 1000);
            if( remain <= 0 ) remain = 0;
            $('time').text(remain);
        }, 100);

        clearTimeout(idTimeout);
        idTimeout = setTimeout(function() {
            $('.q_q').each(function(idx){
                if( idx == data.quizdata.collect ) {
                    $(this).css('background-color','blue');
                }
            })

            clearInterval(idInterval);
            setTimeout(function() {
                $('.quiz_wnd').css('display', 'none');
            }, 3000);
        },13500);
    }

    function registerKeyEvent( socket ) {
        $('.ip_msg').keypress(function(e) {
            var code = (e.keyCode ? e.keyCode : e.which);
            if( code == 13 ) {
                var nick = getNickName();
                var msg = $(this).val();
                if( msg.length > 40 ) {
                    alert('메시지는 짧게');
                    $(this).val('');
                    return;
                }

                if( msg.length <= 0 ) {
                    return;
                }

                if( msg[0] == '/' ) {
                    $(this).val('');
                    if( !isAutoSearchChecked() ) {
                        var query = msg.substr(1);
                        searchWebRoot(socket, query, true);
                    }
                    else {
                        showAdminMsg('반자동 검색을 해제 한 후에 검색을 사용할 수 있습니다');
                    }
                    return;
                }

                var isvote = -1;
                if( msg.search(/111+/g) != -1 || msg == "1") {
                    vote(socket, {idx:0});
                    isvote = 0;
                }
                else if( msg.search(/222+/g) != -1 || msg == "2" ) {
                    vote(socket, {idx:1});
                    isvote = 1;
                }
                else if( msg.search(/333+/g) != -1 || msg == "3") {
                    vote(socket, {idx:2});
                    isvote = 2;
                }

                if( isvote != -1 ) {
                    $(this).val('');
                    return;
                }

                nick = nick.substr(0,14);
                socket.emit('chat', {nickname: nick, msg: msg, isvote: isvote });
                $(this).val('');
            }
        })

        $(document).keypress(function(event) {
            if( $('.ip_name').is(':focus') ) return;
            if( $('.ip_msg').is(':focus') ) return;
            if( event.charCode >= 49 && event.charCode <= 51) {
                var curTime = new Date();
                if( curTime - tClick < 100 ) {
                    return;
                }
                tClick = curTime;

                var idx = event.charCode - 49;

                var nick = getNickName();
                var clicked = (idx+1);
                vote(socket, {idx: idx });
            }
            else {
                $('.ip_msg').val('');
                $('.ip_msg').focus();
                bTrigger = true;
            }
        })

        $('.ip_msg').keyup(function(e) {
            var code = (e.keyCode ? e.keyCode : e.which);
            if( bTrigger ) {
                bTrigger = false;
                if( $(this).val() != '/')
                    $(this).val('');
                return;
            }
            if( code == 27 ) {
                $(this).blur();
            }
        })

        $('.btn_vote').each(function(idx) {
            $(this).click(function() {
                var idx = $(this).attr('data');
                vote(socket, {idx:idx});
            });
        })
    }

    function addChat( isbaned, hash , name, msg, bStrip ) {
        var li = '<li>' +
                '<div class="chat_msg_obj">' +
                '<div class="chat_name '+ (isbaned ? 'baned' : '') +'" hash=' + hash + '>' +
                (bStrip ? strip(name) : name) +
                '</div>' +
                '<div class="chat_text">' +
                (bStrip ? strip(msg) : msg) +
                '</div>' +
                '</div>' +
                '</li>';

        var bAutoMoveToBottom = false;
        var chatwndheight = $('.chat_msg').height();

        if( ($('.chat_msg').get(0).scrollTop == ($('.chat_msg').get(0).scrollHeight - chatwndheight) ) ||
            $('#cb_auto_scroll').is(':checked')) {
            bAutoMoveToBottom = true;
        }

        if(isMobile()) {
            bAutoMoveToBottom = true;
        }

        $('.chat_ul').append(li);

        //  끝 정렬
        if( bAutoMoveToBottom )
            $('.chat_msg').scrollTop($('.chat_msg').get(0).scrollHeight);

    }

    function addBannerAds() {

    }

    function searchWebRoot( socket, query, isBroadcast ) {
        $('.search_article').html('');
        var nick = getNickName();
        socket.emit('search', {nickname: nick, msg: query, isBroadcast : isBroadcast });
        var searched = false;
        if( $('#cb_s0').is(':checked')) {
            searchWeb(0, query);
            searched = true;
        } //  백과사전
        if( $('#cb_s1').is(':checked')) {
            searchWeb(1, query);
            searched = true;
        } //  지시인
        if( $('#cb_s2').is(':checked')) {
            searchWeb(2, query);
            searched = true;
        } //  블로그
        if( $('#cb_s3').is(':checked')) {
            searchWeb(3, query);
            searched = true;
        } //  뉴스

        if( !searched ) {
            $('.search_article').html(htmlBackup);
        }
    }

    function searchWeb( type, query ) {
        $.ajax({
            type: 'POST',
            dataType: 'json',
            data: JSON.stringify({
                query : query,
                type: type
            }),
            contentType: 'application/json',
            url: '/searchex',
            success: function(data) {
                setSearchRet(data);
            }
        });
    }

    function setSearchRet(items) {
        var html = '';
        for( var i = 0 ; i < items.length ; ++i) {
            var item = items[i];
            var div = '<div class="search_ret_root">' +
                            '<div class="search_ret_title">' +
                            item.title +
                            '</div><div class="search_ret_desc">' +
                            item.description +
                            '</div>' +
                            '</div>';

            html += div;
        }

        if( items.length == 0 ) {
            html = '<div style="text-align:center;">검색 결과가 없습니다. 좀 더 신중한 검색!</div>';
        }
        $('.search_article').append(html);
        clearTimeout(timerID);
        timerID = setTimeout(function() {
            $('.search_article').html(htmlBackup);
        }, 12000);
    }

    function getNickName() {
        var nick = strip($('.ip_name').val());
        nick = nick.substr(0,10);
        return nick;
    }

    function setNickName() {
        var rd = Math.floor(Math.random() * 500);
        $('.ip_name').val('손님' + rd);
    }

    function vote(socket, data) {
        data.nickname = getNickName();
        socket.emit('vote', data);
    }

    var animOpacityTimerID = -1;
    function showAdminMsg(msg) {
        var obj = $('.admin_msg');
        if( animOpacityTimerID != -1 ) {
            clearTimeout(animOpacityTimerID);
            animOpacityTimerID = -1;
            obj.removeClass('opacity');
            obj.addClass('non_opacity');
        }
        obj.addClass('opacity');
        obj.removeClass('non_opacity');
        $('.admin_msg').html(msg);
        $('.admin_msg').css('opacity', '0.85');
        animOpacityTimerID = setTimeout(function() {
            $('.admin_msg').css('opacity', '0');
        }, 7000);

    }

    function isAutoSearchChecked() {
        if($('.cb_auto_search').is(':checked')) {
            return true;
        }

        return false;
    }
</script>
</body>
</html>
